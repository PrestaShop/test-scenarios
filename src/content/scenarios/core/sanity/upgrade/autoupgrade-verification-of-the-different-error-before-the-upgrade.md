---
title: "Autoupgrade - Verification of the different error before the upgrade"
weight: 12
---

# Autoupgrade - Verification of the different error before the upgrade
## Details
* **Component** : Core
* **Status** : Approved
* **Scenario** : https://forge.prestashop.com/browse/TEST-9699

## Steps
| Step Description | Expected result |
| ----- | ----- |
| Install A fresh 8.1.5 | You should have the selection of where in your shop you want to go ( BO or FO ) |
| Go to the BO | You should have your dashboard showed |
| Go to the Module Catalog" page" | Module Catalog page is displayed correctly |
| Search for the 1-click Install" module. Install it" | Module is correctly installed |
| Go to the General Parameters > Maintenance" page. Put the shop in maintenance mode" | Maintenance page is displayed correctly. Maintenance mode is activated |
| Set your "Maintenance IP" by clicking the button "+ Add my IP" and clic on "Save" button | Your IP should be setted on the field and you will have the green notification |
| * Go to the update assistant page | * You should see the configuration page of the module |
| Go to your folder [yourshopname_folder] > module > Autoupgrade > Upgrade | Some files should be named upgrade [...].php instead of install[...].php |
| * Go to your folder [yourshopname_folder] > module > Autoupgrade > classes > Task > Upgrade > Download.php<br> * At line 49, in "public function run", put "throw new Exception("Brique");" and save the folder | * You should see the diffenrent fonction in this php files<br> * The files should be saved |
| Click on get started and follow the different step until the update step. | Upgrade is launched and at the "Step download", you should have an exception with : <br> * a yellow exception with title "Update failed" and description : "Your store may not work properly anymore. Select the backup you want to use and restore it to avoid any data loss." <br> * A restore button should be on the right in the yellow exception <br> * You should have 3 red cross :<br> ** the first one with on the first line at the end "Exception: Brique"<br> ** the second with "It seems there was an issue with the server. This type of error usually happens when [...]"<br> ** the third with " HTTP request failed. Type: ERR_BAD_RESPONSE - HTTP Code: 500"<br> * You should have an "Error Summary" where the 3 red cross is repeted but have a link See error at the end of the line <br> * a button "Download update logs"<br> * a button "Send error report "<br> * a blue "Restore" button with an icon in it |
| * Next to the first cross error on "Error summary", click on see Error<br> * Click on "Download update logs" | * The background of the first error on logs part should be put on grey and fade to the basic color of the background <br> * The download of the update logs should be launched by your bowser |
| Click on "Send error report" button | You should have a modal with : <br> * title on bold : Send error report? <br> * a description with :  Help us improve the module by sending us this error report. For your information, the logs will be attached with your message. You can add more details in the description if you wish. <br> * a link with text : Learn more about your data and your rights"<br> * An "Error message" box with the last error on it and with a grey bacjground, this box can't be edited and when your mouse is put on it you should have a error icon on your cursor<br> * An "Email (optional)" box where you can edit the box <br> * A "Description (optional)" box where you can edit the box <br> * A "Cancel" button <br> * A "Send error report" button |
| * Click on "Learn more about your data and your rights" <br> * Close the tab of Data transparency<br> * Click on "Email (optional)" box<br> * Click on "Description (optional)" box <br> * Click on the cross or the "Cancel" button or not int he modal | * A new page should be open with title "Data transparency" <br> * You should return on the send error report <br> * The Background of the"Email" box should be put on yellow<br> * The background of the "Email" box should be return on grey and the background of the "Description" box should be put on yellow <br> * The modal should be closed |
| * Click on "Send error report" button <br> * Fill the Email and description part <br> * Click on "Send error report" button | * The modal "Send error report?" should be opened<br> * The "Email" and "Description" part should be set up<br> * The modal should be closed |
| Go to the link  on other tab : [https://prestashop.sentry.io/feedback/?feedbackSlug=autoupgrade-module%3A6504514401&mailbox=ignored&project=4507254110552064&referrer=feedback_list_page] | * You should be on a page named "User feedback", on the spam categorie<br> * The last user feedback should be yours with the email you set and under the description you said <br> * On the right of the list of feedback, you should have the detail of the error with : <br> ** The different files linked to the error : "logs.txt" "response_raws.txt" and "summary_errors.txt"<br> ** the Url <br> ** Linked Error <br> ** Linked Replay <br> ** Tags <br> ** Internal Activity |
| * Go to the link on another tab  "https://eu.mixpanel.com/project/2828312/view/3362352/app/events#9ad5X2HJqJ7y"<br> * set on filter the parameters | You should see : <br> * [SUE] Upgrade Launched<br> * [SUE] Upgrade Failed <br> * Identity<br><br>With the same Anonymous ID and php write like "X.X.XX" |
| * Close the tab <br> * Reload your page | * You should return on your update page <br> * Update should be relaunch from the start of the loading bar and it should fail after few second |
| Click on "Restore" button in the yellow exception | You should be redirected to the "Backup Selection" page |
| * Return at the Download.php files and replace "throw new Exception("Brique");" by "exit(0);" and save<br> * Clic on "Update assistant" in the sideboard menu | * The files should be saved<br> * You should be on the page "Welcome to PrestaShop Update Assistant" |
| Click on get started and follow the different step until the update step. | * Upgrade is launched<br> * You quickly only have two red cross error : <br><br> ** It looks like there is no data received from the server. This can happen if: The server is temporarily unavailable. There's an issue with the network or connection.<br> ** HTTP request failed. Type: APP_ERR_RESPONSE_EMPTY - HTTP Code: 200 |
| * Click on the blue "Restore" button<br> * Click on the button "Delete selection" <br> * Click on "Delete" button <br> * Click on the button "Delete selection" again <br> * Click on "Delete" | * You should be redirected to the "Backup Selection" page<br> * You should have a "Delete backup " modal <br> * The backup should be deleted<br> * You should have a "Delete backup " modal with description "You are about to delete the [nameOfBackup] backup made on[DateAndTime] As it's your only backup, you will be redirected to the module's home page. "<br> * You should be on Welcome Page of the update assistant |
| Return at the Download.php files and replace "exit(0);" by "while(true) {}" and save | The file should be saved |
| * Click on get started and follow the different step until the update step without backup<br> * Reload the page during the loading <br> * Click on "Leave page" | * Upgrade is launched<br> * a modal should be displayed with "This page is asking you to confirm that you want to leave — information you’ve entered may not be saved." with two button "Stay on page" and "Leave page"<br> * Upgrade should be launched again |
| Wait until the end of the load for the upgrade | Because we don't have backup, we should have an exception with : <br> * a red exception with title "Update failed" and description : "You didn’t back up your store with the Update assistant module but you can restore using your own manual backup." <br> * You should have 3 red cross :<br><br> ** the first one with on the first line at the end "Maximum execution time of [yourMaxExecutionTime] seconds exceeded"<br> ** the second with "It seems there was an issue with the server. This type of error usually happens when [...]"<br> ** the third with " HTTP request failed. Type: ERR_BAD_RESPONSE - HTTP Code: 500"<br> * You should have an "Error Summary" where the 3 red cross is repeted but have a link See error at the end of the line <br> * a button "Download update logs"<br> * a button "Send error report "<br> * a blue "Restore" button with an icon in it |
| * Clic on "Update assistant" in the sideboard menu | * You should be redirected to the welcome page of Upgrade Assistant |
| Return at the Download.php files and delete "while(true) {}" and save | The file should be saved |
| * Go to your [admin_folder_name] <br> * open a terminal in this folder<br> * On the terminal, launch "sudo chmod 000 autoupgrade" | * You should have "backup", "autoupgrade", "export", "filemanager" and "import" "public" and"theme" folder <br> * A new terminal appears ! <br> * you should have a new line to enter |
| * Reload the autoupgrade page<br>* Enable the debug mode | * Preston should say that there is an issue <br>* You should have a red exception with "Cannot write to the directory. Please ensure you have the necessary write permissions on "/var/www/html/pr_autoup/admin-dev/autoupgrade"." |
| * Return on your terminal and launch "sudo chmod 777 autoupgrade"<br> * Reload the update assistant page | * You should have a new line to enter<br> * Your Welcome page is displayed correctly |
| On the link of your bowser, delete the part "home-page" of "route=home-page" and press enter | You should have : <br> * A 404 image <br> * A title :  Something went wrong... <br> * A description with "The requested page or resource could not be found. This might be due to:<br> * A broken or outdated link.<br> * The page being moved or deleted.<br> * A typo in the URL." |
| * Reload the page<br> * Click on "Update your Store"<br> * Click on "Get Started" | * You should be redirected to Welcome page assistant<br> * The button "Get Started" should be Enabled<br> * You should be redirected to "Version Choice" page |
| * Go to your folder [yourshopname_folder] > module > Autoupgrade > classes > UpgradeSelfCheck.php<br> * in "public function getErrors(): array" and  "public function getWarnings(): array", invert all the condition and save the folder | * You should see the diffenrent fonction in this php files<br> * The files should be saved |
| Click on the Version set un Online version | The checking requirement should have 15 errors and 3 warning :<br><br>Errors part with a red cross before the text : <br> * Your store's root directory /var/www/html/pr_autoup isn't writable. Provide write access to the user running PHP with appropriate permission & ownership.<br> * The /var/www/html/pr_autoup/admin-dev/autoupgrade directory isn't writable. Provide write access to the user running PHP with appropriate permission & ownership.<br> * Files can't be downloaded. Enable PHP's "allow_url_fopen" option or install PHP extension "cURL".<br> * Missing PHP extension "zip".<br> * Maintenance mode needs to be enabled. Enable maintenance mode and add your maintenance IP in Shop parameters > General > Maintenance.<br> * PrestaShop's caching features needs to be disabled. Disable caching features in Advanced parameters > Performance > Caching.<br> * Apache mod_rewrite needs to be enabled.<br> * The following PHP extensions need to be installed:<br> * The following PHP functions need to be allowed:<br> * PHP memory_limit needs to be greater than 256 MB.<br> * PHP file_uploads configuration needs to be enabled.<br> * Unable to generate private keys using openssl_pkey_new. Check your OpenSSL configuration, especially the path to openssl.cafile.<br> * It's not possible to write in the following folders. Provide write access to the user running PHP with appropriate permission & ownership:<br> * The version of PrestaShop does not match the one stored in database. Your database structure may not be up-to-date and/or the value of PS_VERSION_DB needs to be updated in the configuration table.<br> * We were unable to fetch missing or altered files. In these conditions, your store cannot be updated to avoid any further bugs.<br><br>Warning part with a yellow warning before <br> * Your current version of the module is out of date. Update now Modules > Module Manager > Updates<br> * Some theme files have been altered or removed. Any changes made to these files may be overwritten during the update. See the list of changes.<br> * Some core files have been altered or removed. Any changes made to these files may be overwritten during the update. See the list of changes. |
| * Click on the developper documentation <br> * Click on the "Shop parameters > General > Maintenance+.+ " link <br> * Click on the " Advanced parameters > Performance > Caching." link<br> * Click on the " Modules > Module Manager > Updates" link | * You should be redirect on a new tab with title "Update from the back office" <br> * You should be redirect on a new tab of your BO, in the maintenance tab of the general shop parameters<br> * You should be redirect on a new tab of your BO In your performance page <br> * You should be redirect on a new tab of your BO in your Update tab of Module Manager tab |
